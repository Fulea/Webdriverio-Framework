"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const junit_report_builder_1 = __importDefault(require("junit-report-builder"));
const reporter_1 = __importDefault(require("@wdio/reporter"));
const utils_1 = require("./utils");
/**
 * Reporter that converts test results from a single instance/runner into an XML JUnit report. This class
 * uses junit-report-builder (https://github.com/davidparsson/junit-report-builder) to build report.The report
 * generated from this reporter should conform to the standard JUnit report schema
 * (https://github.com/junit-team/junit5/blob/master/platform-tests/src/test/resources/jenkins-junit.xsd).
 */
class JunitReporter extends reporter_1.default {
    constructor(options) {
        super(options);
        this.options = options;
        this._suiteNameRegEx = this.options.suiteNameFormat instanceof RegExp
            ? this.options.suiteNameFormat
            : /[^a-zA-Z0-9@]+/; // Reason for ignoring @ is; reporters like wdio-report-portal will fetch the tags from testcase name given as @foo @bar
    }
    onRunnerEnd(runner) {
        const xml = this._buildJunitXml(runner);
        this.write(xml);
    }
    _prepareName(name = 'Skipped test') {
        return name.split(this._suiteNameRegEx).filter((item) => item && item.length).join(' ');
    }
    _addFailedHooks(suite) {
        /**
         * Add failed hooks to suite as tests.
         */
        const failedHooks = suite.hooks.filter(hook => hook.error && hook.title.match(/^"(before|after)( all| each)?" hook/));
        failedHooks.forEach(hook => {
            const { title, _duration, error, state } = hook;
            suite.tests.push({
                _duration,
                title,
                error,
                state: state,
                output: []
            });
        });
        return suite;
    }
    _addCucumberFeatureToBuilder(builder, runner, specFileName, suite) {
        const featureName = this._prepareName(suite.title);
        const filePath = specFileName.replace(process.cwd(), '.');
        if (suite.type === 'feature') {
            const feature = builder.testSuite()
                .name(featureName)
                .timestamp(suite.start)
                .time(suite._duration / 1000)
                .property('specId', 0)
                .property(this._suiteTitleLabel, suite.title)
                .property('capabilities', runner.sanitizedCapabilities)
                .property(this._fileNameLabel, filePath);
            this._activeFeature = feature;
            this._activeFeatureName = featureName;
        }
        else if (this._activeFeature) {
            let scenario = suite;
            const testName = this._prepareName(suite.title);
            const testCase = this._activeFeature.testCase()
                .className(`${this._packageName}.${this._activeFeatureName}`)
                .name(`${testName}`)
                .time(scenario._duration / 1000);
            if (this.options.addFileAttribute) {
                testCase.file(filePath);
            }
            scenario = this._addFailedHooks(scenario);
            let stepsOutput = '';
            let isFailing = false;
            for (let stepKey of Object.keys(scenario.tests)) { // tests are trested as steps in Cucumber
                if (stepKey === 'undefined') { // fix cucumber hooks crashing reporter
                    continue;
                }
                let stepEmoji = '✅';
                const step = scenario.tests[stepKey];
                if (step.state === 'pending' || step.state === 'skipped') {
                    if (!isFailing) {
                        testCase.skipped();
                    }
                    stepEmoji = '⚠️';
                }
                else if (step.state === 'failed') {
                    if (step.error) {
                        if (this.options.errorOptions) {
                            const errorOptions = this.options.errorOptions;
                            for (const key of Object.keys(errorOptions)) {
                                testCase[key](step.error
                                    ? step.error[errorOptions[key]]
                                    : null);
                            }
                        }
                        else {
                            // default
                            testCase.error(step.error.message);
                        }
                        testCase.standardError(`\n${step.error.stack}\n`);
                    }
                    else {
                        testCase.error();
                    }
                    testCase.failure();
                    isFailing = true;
                    stepEmoji = '❗';
                }
                const output = this._getStandardOutput(step);
                stepsOutput += output ? stepEmoji + ' ' + step.title : stepEmoji + ' ' + step.title + '\n' + output;
            }
            testCase.standardOutput(`\n${stepsOutput}\n`);
        }
        return builder;
    }
    _addSuiteToBuilder(builder, runner, specFileName, suite) {
        const suiteName = this._prepareName(suite.title);
        const filePath = specFileName.replace(process.cwd(), '.');
        let testSuite = builder.testSuite()
            .name(suiteName)
            .timestamp(suite.start)
            .time(suite._duration / 1000)
            .property('specId', 0)
            .property(this._suiteTitleLabel, suite.title)
            .property('capabilities', runner.sanitizedCapabilities)
            .property(this._fileNameLabel, filePath);
        suite = this._addFailedHooks(suite);
        for (let testKey of Object.keys(suite.tests)) {
            if (testKey === 'undefined') { // fix cucumber hooks crashing reporter (INFO: we may not need this anymore)
                continue;
            }
            const test = suite.tests[testKey];
            const testName = this._prepareName(test.title);
            const testCase = testSuite.testCase()
                .className(`${this._packageName}.${suiteName}`)
                .name(testName)
                .time(test._duration / 1000);
            if (this.options.addFileAttribute) {
                testCase.file(filePath);
            }
            if (test.state === 'pending' || test.state === 'skipped') {
                testCase.skipped();
            }
            else if (test.state === 'failed') {
                if (test.error) {
                    if (this.options.errorOptions) {
                        const errorOptions = this.options.errorOptions;
                        for (const key of Object.keys(errorOptions)) {
                            testCase[key](test.error[errorOptions[key]]);
                        }
                    }
                    else {
                        // default
                        testCase.error(test.error.message);
                    }
                    testCase.standardError(`\n${test.error.stack}\n`);
                }
                else {
                    testCase.error();
                }
                testCase.failure();
            }
            const output = this._getStandardOutput(test);
            if (output)
                testCase.standardOutput(`\n${output}\n`);
        }
        return builder;
    }
    _buildJunitXml(runner) {
        let builder = junit_report_builder_1.default.newBuilder();
        if (runner.config.hostname !== undefined && runner.config.hostname.indexOf('browserstack') > -1) {
            // NOTE: deviceUUID is used to build sanitizedCapabilities resulting in a ever-changing package name in runner.sanitizedCapabilities when running Android tests under Browserstack. (i.e. ht79v1a03938.android.9)
            // NOTE: platformVersion is used to build sanitizedCapabilities which can be incorrect and includes a minor version for iOS which is not guaranteed to be the same under Browserstack.
            const browserstackSanitizedCapabilities = [
                runner.capabilities.device,
                runner.capabilities.os,
                (runner.capabilities.os_version || '').replace(/\./g, '_'),
            ]
                .filter(Boolean)
                .map((capability) => capability.toLowerCase())
                .join('.')
                .replace(/ /g, '') || runner.sanitizedCapabilities;
            this._packageName = this.options.packageName || browserstackSanitizedCapabilities;
        }
        else {
            this._packageName = this.options.packageName || runner.sanitizedCapabilities;
        }
        const isCucumberFrameworkRunner = runner.config.framework === 'cucumber';
        if (isCucumberFrameworkRunner) {
            this._packageName = `CucumberJUnitReport-${this._packageName}`;
            this._suiteTitleLabel = 'featureName';
            this._fileNameLabel = 'featureFile';
        }
        else {
            this._suiteTitleLabel = 'suiteName';
            this._fileNameLabel = 'file';
        }
        // there should only be one spec file per runner so we can safely take the first element of the array
        const specFileName = runner.specs[0];
        if (isCucumberFrameworkRunner) {
            this._buildOrderedReport(builder, runner, specFileName, 'feature', isCucumberFrameworkRunner);
            this._buildOrderedReport(builder, runner, specFileName, 'scenario', isCucumberFrameworkRunner);
        }
        else {
            this._buildOrderedReport(builder, runner, specFileName, '', isCucumberFrameworkRunner);
        }
        return builder.build();
    }
    _buildOrderedReport(builder, runner, specFileName, type, isCucumberFrameworkRunner) {
        for (let suiteKey of Object.keys(this.suites)) {
            /**
             * ignore root before all
             */
            /* istanbul ignore if  */
            if (suiteKey.match(/^"before all"/)) {
                continue;
            }
            const suite = this.suites[suiteKey];
            if (isCucumberFrameworkRunner && suite.type === type) {
                builder = this._addCucumberFeatureToBuilder(builder, runner, specFileName, suite);
            }
            else if (!isCucumberFrameworkRunner) {
                builder = this._addSuiteToBuilder(builder, runner, specFileName, suite);
            }
        }
        return builder;
    }
    _getStandardOutput(test) {
        let standardOutput = [];
        test.output.forEach((data) => {
            switch (data.type) {
                case 'command':
                    standardOutput.push(data.method
                        ? `COMMAND: ${data.method.toUpperCase()} ` +
                            `${data.endpoint.replace(':sessionId', data.sessionId)} - ${this._format(data.body)}`
                        : `COMMAND: ${data.command} - ${this._format(data.params)}`);
                    break;
                case 'result':
                    standardOutput.push(`RESULT: ${this._format(data.body)}`);
                    break;
            }
        });
        return standardOutput.length ? standardOutput.join('\n') : '';
    }
    _format(val) {
        return JSON.stringify(utils_1.limit(val));
    }
}
exports.default = JunitReporter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxnRkFBd0M7QUFDeEMsOERBQWlGO0FBRWpGLG1DQUErQjtBQUcvQjs7Ozs7R0FLRztBQUNILE1BQU0sYUFBYyxTQUFRLGtCQUFZO0lBUXBDLFlBQW9CLE9BQTZCO1FBQzdDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQURFLFlBQU8sR0FBUCxPQUFPLENBQXNCO1FBRTdDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLFlBQVksTUFBTTtZQUNqRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlO1lBQzlCLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQSxDQUFDLHdIQUF3SDtJQUNuSixDQUFDO0lBRUQsV0FBVyxDQUFFLE1BQW1CO1FBQzVCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDdkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUNuQixDQUFDO0lBRU8sWUFBWSxDQUFFLElBQUksR0FBRyxjQUFjO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsTUFBTSxDQUMxQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQ2hDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ2YsQ0FBQztJQUVPLGVBQWUsQ0FBQyxLQUFpQjtRQUNyQzs7V0FFRztRQUNILE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDLENBQUE7UUFDckgsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN2QixNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFBO1lBQy9DLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO2dCQUNiLFNBQVM7Z0JBQ1QsS0FBSztnQkFDTCxLQUFLO2dCQUNMLEtBQUssRUFBRSxLQUE0QjtnQkFDbkMsTUFBTSxFQUFFLEVBQUU7YUFDTixDQUFDLENBQUE7UUFDYixDQUFDLENBQUMsQ0FBQTtRQUNGLE9BQU8sS0FBSyxDQUFBO0lBQ2hCLENBQUM7SUFFTyw0QkFBNEIsQ0FDaEMsT0FBWSxFQUNaLE1BQW1CLEVBQ25CLFlBQW9CLEVBQ3BCLEtBQWlCO1FBRWpCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ2xELE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBRXpELElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxTQUFTLEVBQUU7WUFDMUIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRTtpQkFDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQztpQkFDakIsU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7aUJBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztpQkFDNUIsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7aUJBQ3JCLFFBQVEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQztpQkFDNUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMscUJBQXFCLENBQUM7aUJBQ3RELFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1lBQzVDLElBQUksQ0FBQyxjQUFjLEdBQUcsT0FBTyxDQUFBO1lBQzdCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxXQUFXLENBQUE7U0FDeEM7YUFBTSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDNUIsSUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFBO1lBQ3BCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBRS9DLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFO2lCQUMxQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2lCQUM1RCxJQUFJLENBQUMsR0FBRyxRQUFRLEVBQUUsQ0FBQztpQkFDbkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUE7WUFFcEMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFO2dCQUMvQixRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO2FBQzFCO1lBRUQsUUFBUSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUE7WUFFekMsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFBO1lBQ3BCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQTtZQUNyQixLQUFLLElBQUksT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUseUNBQXlDO2dCQUN4RixJQUFJLE9BQU8sS0FBSyxXQUFXLEVBQUUsRUFBRSx1Q0FBdUM7b0JBQ2xFLFNBQVE7aUJBQ1g7Z0JBRUQsSUFBSSxTQUFTLEdBQUcsR0FBRyxDQUFBO2dCQUNuQixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLE9BQWMsQ0FBQyxDQUFBO2dCQUMzQyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFO29CQUN0RCxJQUFJLENBQUMsU0FBUyxFQUFFO3dCQUNaLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtxQkFDckI7b0JBQ0QsU0FBUyxHQUFHLElBQUksQ0FBQTtpQkFDbkI7cUJBQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRTtvQkFDaEMsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO3dCQUNaLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUU7NEJBQzNCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFBOzRCQUM5QyxLQUFLLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0NBQ3pDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSztvQ0FDcEIsQ0FBQyxDQUFFLElBQUksQ0FBQyxLQUFhLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29DQUN4QyxDQUFDLENBQUMsSUFBSSxDQUNULENBQUE7NkJBQ0o7eUJBQ0o7NkJBQU07NEJBQ0gsVUFBVTs0QkFDVixRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUE7eUJBQ3JDO3dCQUNELFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUE7cUJBQ3BEO3lCQUFNO3dCQUNILFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtxQkFDbkI7b0JBQ0QsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFBO29CQUNsQixTQUFTLEdBQUcsSUFBSSxDQUFBO29CQUNoQixTQUFTLEdBQUcsR0FBRyxDQUFBO2lCQUNsQjtnQkFDRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUE7Z0JBQzVDLFdBQVcsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksR0FBRyxNQUFNLENBQUE7YUFDdEc7WUFDRCxRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssV0FBVyxJQUFJLENBQUMsQ0FBQTtTQUNoRDtRQUNELE9BQU8sT0FBTyxDQUFBO0lBQ2xCLENBQUM7SUFFTyxrQkFBa0IsQ0FDdEIsT0FBWSxFQUNaLE1BQW1CLEVBQ25CLFlBQW9CLEVBQ3BCLEtBQWlCO1FBRWpCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ2hELE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBRXpELElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQUU7YUFDOUIsSUFBSSxDQUFDLFNBQVMsQ0FBQzthQUNmLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO2FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQzthQUM1QixRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQzthQUNyQixRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUM7YUFDNUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMscUJBQXFCLENBQUM7YUFDdEQsUUFBUSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFFNUMsS0FBSyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFbkMsS0FBSyxJQUFJLE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMxQyxJQUFJLE9BQU8sS0FBSyxXQUFXLEVBQUUsRUFBRSw0RUFBNEU7Z0JBQ3ZHLFNBQVE7YUFDWDtZQUVELE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBYyxDQUFDLENBQUE7WUFDeEMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDOUMsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLFFBQVEsRUFBRTtpQkFDaEMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksSUFBSSxTQUFTLEVBQUUsQ0FBQztpQkFDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztpQkFDZCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQTtZQUVoQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQy9CLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7YUFDMUI7WUFFRCxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFO2dCQUN0RCxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUE7YUFDckI7aUJBQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRTtnQkFDaEMsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO29CQUNaLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUU7d0JBQzNCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFBO3dCQUM5QyxLQUFLLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7NEJBQ3pDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBRSxJQUFJLENBQUMsS0FBYSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7eUJBQ3hEO3FCQUNKO3lCQUFNO3dCQUNILFVBQVU7d0JBQ1YsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO3FCQUNyQztvQkFDRCxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFBO2lCQUNwRDtxQkFBTTtvQkFDSCxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUE7aUJBQ25CO2dCQUNELFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTthQUNyQjtZQUVELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUM1QyxJQUFJLE1BQU07Z0JBQUUsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLE1BQU0sSUFBSSxDQUFDLENBQUE7U0FDdkQ7UUFDRCxPQUFPLE9BQU8sQ0FBQTtJQUNsQixDQUFDO0lBRU8sY0FBYyxDQUFFLE1BQW1CO1FBQ3ZDLElBQUksT0FBTyxHQUFHLDhCQUFLLENBQUMsVUFBVSxFQUFFLENBQUE7UUFDaEMsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsS0FBSyxTQUFTLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQzdGLGlOQUFpTjtZQUNqTixzTEFBc0w7WUFDdEwsTUFBTSxpQ0FBaUMsR0FBRztnQkFDckMsTUFBTSxDQUFDLFlBQWlELENBQUMsTUFBTTtnQkFDL0QsTUFBTSxDQUFDLFlBQWlELENBQUMsRUFBRTtnQkFDNUQsQ0FBRSxNQUFNLENBQUMsWUFBaUQsQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUM7YUFDbkc7aUJBQ0ksTUFBTSxDQUFDLE9BQU8sQ0FBQztpQkFDZixHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLFVBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztpQkFDOUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztpQkFDVCxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQTtZQUN0RCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxJQUFJLGlDQUFpQyxDQUFBO1NBQ3BGO2FBQU07WUFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxJQUFJLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQTtTQUMvRTtRQUVELE1BQU0seUJBQXlCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEtBQUssVUFBVSxDQUFBO1FBQ3hFLElBQUkseUJBQXlCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLFlBQVksR0FBRyx1QkFBdUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1lBQzlELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxhQUFhLENBQUE7WUFDckMsSUFBSSxDQUFDLGNBQWMsR0FBRyxhQUFhLENBQUE7U0FDdEM7YUFBTTtZQUNILElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxXQUFXLENBQUE7WUFDbkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUE7U0FDL0I7UUFFRCxxR0FBcUc7UUFDckcsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNwQyxJQUFJLHlCQUF5QixFQUFFO1lBQzNCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUseUJBQXlCLENBQUMsQ0FBQTtZQUM3RixJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLHlCQUF5QixDQUFDLENBQUE7U0FDakc7YUFBTTtZQUNILElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxFQUFFLEVBQUUseUJBQXlCLENBQUMsQ0FBQTtTQUN6RjtRQUVELE9BQU8sT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFBO0lBQzFCLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxPQUFZLEVBQUUsTUFBbUIsRUFBRSxZQUFvQixFQUFFLElBQVksRUFBRSx5QkFBa0M7UUFDakksS0FBSyxJQUFJLFFBQVEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMzQzs7ZUFFRztZQUNILHlCQUF5QjtZQUN6QixJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLEVBQUU7Z0JBQ2pDLFNBQVE7YUFDWDtZQUNELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDbkMsSUFBSSx5QkFBeUIsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLElBQUksRUFBRTtnQkFDbEQsT0FBTyxHQUFHLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQTthQUNwRjtpQkFBTSxJQUFJLENBQUMseUJBQXlCLEVBQUU7Z0JBQ25DLE9BQU8sR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUE7YUFDMUU7U0FDSjtRQUNELE9BQU8sT0FBTyxDQUFBO0lBQ2xCLENBQUM7SUFFTyxrQkFBa0IsQ0FBRSxJQUFlO1FBQ3ZDLElBQUksY0FBYyxHQUFhLEVBQUUsQ0FBQTtRQUNqQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3pCLFFBQVEsSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDbkIsS0FBSyxTQUFTO29CQUNWLGNBQWMsQ0FBQyxJQUFJLENBQ2YsSUFBSSxDQUFDLE1BQU07d0JBQ1AsQ0FBQyxDQUFDLFlBQVksSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsR0FBRzs0QkFDeEMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO3dCQUN2RixDQUFDLENBQUMsWUFBWSxJQUFJLENBQUMsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQ2xFLENBQUE7b0JBQ0QsTUFBSztnQkFDVCxLQUFLLFFBQVE7b0JBQ1QsY0FBYyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtvQkFDekQsTUFBSzthQUNSO1FBQ0wsQ0FBQyxDQUFDLENBQUE7UUFDRixPQUFPLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUNqRSxDQUFDO0lBRU8sT0FBTyxDQUFFLEdBQVE7UUFDckIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBQ3JDLENBQUM7Q0FDSjtBQUVELGtCQUFlLGFBQWEsQ0FBQSJ9